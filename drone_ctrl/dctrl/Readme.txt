=================================================================================
Date 2022.08.24
Rev  0.6_082204
-------------------------------------------------------------
機体制御プログラム: ~/drone_ctrl/ardctrl.py
検証用制御画面: /var/www/html/simpel_gcs/html/index.html
-------------------------------------------------------------
【変更点】

（１）
WPアクション実行時に、アクションの一時停止および、再開
ミッションの終了が実行できるように修正

各状態における動作は次のようになっています。


■操作の有効/無効

                 Mission    WpAction    Mission/WpAction
                 飛行中     実行中      一時停止中
                -----------------------------------------
Mission一時停止   有効       有効        無効
Mission再開       無効       無効        有効
Mission終了       無効       無効        有効


■動作概要

-------------------------------------------------------------------------------------------------------------------
                | WpAction実行時           　　　　　　　　　　　　　　　　　　    | MissionN移動時
-------------------------------------------------------------------------------------------------------------------
                | WpAction(ホバリング)         | WPアクション(回転)             | Mission移動時
-------------------------------------------------------------------------------------------------------------------
Mission一時停止 | ①カウントダウン停止         | ①回転処理は実行               | その場で飛行停止しホバリング
                | ②カウントダウンタイマクリア | ②回転終了後その場でホバリング | 
                | ③その場でホバリング継続     |                                | 
-------------------------------------------------------------------------------------------------------------------
Mission再開     | 次のWPアクションを実施       | 次のWPアクションを実施         | ホバリング位置から飛行再開
-------------------------------------------------------------------------------------------------------------------
Mission終了     | ①ミッションを終了           | ①ミッションを終了             | ①ミッションを終了
                | ②ミッションデータをクリア   | ②ミッションデータをクリア     | ②ミッションデータをクリア
-------------------------------------------------------------------------------------------------------------------

（２）
・GPSロック状態を出力
drone_info['gps']['fixtype'] = message.fix_type

=================================================================================
Rev 2022.08.23
-------------------------------------------------------------
機体制御プログラム: ~/drone_ctrl/ardctrl.py
検証用制御画面: /var/www/html/simpel_gcs/html/index.html
-------------------------------------------------------------
【新規対応】
・下記データで送信されるWPアクションに対応
WPアクション実行後は自動的にAUTOモードになり、次のミッションが実行される
---------------------------------------------------------------------------------
// ウェイポイントアクションデータ
let wp_action = {
  "WP1_actions" : {
        "waypoint":1,                     // 1番目のウェイポイント
        "action_num" :2,                  // ウェイポイントアクション数
        "WP1_action1" : {                 // 1つめのアクション内容
            "action_type" : "hovering",   // アクションタイプ（ホバリング）
            "value" : 5,                  // ホバリング5秒
        },
        "WP1_action2" : {                 // 2つめのアクション内容
            "action_type" : "rotate",     // アクションタイプ（機体回転）
            "value" :90,                  // 機体回転CW90度
        },
        "WP1_action3" : {                 // 3つめのアクション内容
            "action_type" : "hovering",   // アクションタイプ（ホバリング）
            "value" :10,                  // ホバリング10秒
        },
        "WP1_action4" : {                 // 4つめのアクション内容
            "action_type" : "rotate",     // アクションタイプ（機体回転）
            "value" :-90,                 // 機体回転CCW90度
        },
        "WP1_action5" : {                 // 5つめのアクション内容
            "action_type" : "hovering",   // アクションタイプ（ホバリング）
            "value" :8,                   // ホバリング8秒
        },
        "WP1_action6" : {                 // 6つめのアクション内容
            "action_type" : "rotate",     // アクションタイプ（機体回転）
            "value" :275,                 // 機体回転CW275度
        },
        "WP1_action7" : {                 // 7つめのアクション内容
            "action_type" : "hovering",   // アクションタイプ（ホバリング）
            "value" :90,                  // ホバリング秒数
        }
    },

    ///// 以下同様に8番目のWPまでのデータを設定 ////

}

=================================================================================
■■■未リリース■■■
Rev 2022.08.19-2
-------------------------------------------------------------
機体制御プログラム: ~/drone_ctrl/ardctrl.py
検証用制御画面: /var/www/html/simpel_gcs/html/index.html
-------------------------------------------------------------
【変更点】
・各WP移動時の速度を設定（これ以前のVerでは10固定）
　ardctrl.pyの差し替えが必要
  index.html
  map_ctrl.js
・GUIDED時の回転、移動、高度変更の処理をMQTTのon_messageコールバックから
　メイン処理部へ移動
　→　コールバックで重い処理を行うと、処理中にMQTT送受信が行われないため。


=================================================================================
Rev 2022.08.19
-------------------------------------------------------------
機体制御プログラム: ~/drone_ctrl_0819/ardctrl.py
検証用制御画面: /var/www/html/contents_0819/html/index.html
-------------------------------------------------------------

【新規対応】
（１）機体回転（GUIDEDモード時のみ動作します）
現在のヘディング方向からの相対角度を指定してヘディング方向を変更する機能
　正値を設定した場合：右（ＣＷ）回転
　負値を設定した場合：左（ＣＣＷ）回転
設定例
　Droneコマンド「ROTATE」を設定してコマンドを送信します。
　  drone_command = {
      "operation":"ROTATE",  # コマンド: ROTATE
      "subcode":"",       # 設定不要
      "d_lat":"0",        # 設定不要 
      "d_lon":"0",        # 設定不要 
      "d_alt":"30.0",      # 現在高度からの相対角度（この場合、30度右回転します） 
      "d_spd":"0"         # 設定不要 
    }

（２）へディング方向への移動（GUIDEDモード時のみ動作します）
現在位置から進行方向へ設定位置分移動する機能
進行方向前後方向をX、進行方向左右方向をYで設定
　Xに正値を設定した場合：前進
　Xに負値を設定した場合：後進
　Yに正値を設定した場合：右方向移動
　Yに負値を設定した場合：左方向移動
設定例
　Droneコマンド「MOVE」を設定してコマンドを送信します。
　  drone_command = {
      "operation":"MOVE", # コマンド: MOVE
      "subcode":"",       # 設定不要
      "d_lat":"3.0",      # X方向（前後）設定 
      "d_lon":"2.0",      # Y方向（左右）設定 
      "d_alt":"0",        # 設定不要 
      "d_spd":"0"         # 設定不要 
    }
    上記設定の場合、前方3.0m、右方向2.0mの位置（斜め方向）へ移動します。

（３）高度変更（GUIDEDモード時のみ動作します）
現在高度から相対高度を指定して対地高度を変更する機能
　正値を設定した場合：上昇
　負値を設定した場合：降下
設定例
　Droneコマンド「ALT」を設定してコマンドを送信します。
　  drone_command = {
      "operation":"ALT",  # コマンド: ALT
      "subcode":"",       # 設定不要
      "d_lat":"0",        # 設定不要 
      "d_lon":"0",        # 設定不要 
      "d_alt":"1.0",      # 現在高度からの相対高度値（この場合、1.0m上昇します） 
      "d_spd":"0"         # 設定不要 
    }


※現状把握している懸念事項
（１）、（２）の動作時にMQTT送信がされないためか、画面へのステータス反映
ができない。機体自体はシームレスに動作している。
→　原因はMQTTのon_messageコールバック内で実行しているため、処理中にMQTT送信が行われない
ため。時期Varで修正予定

【　修正点　】
・ミッション中断時にウェイポイントアクションが実行され続ける現象を修正
・最後のウェイポイントでウェイポイントアクションが実行されない不具合を修正

=================================================================================

Rev 2022.08.16
【　修正点　】
・ミッション連続実行時の不具合対策
2回目の実行時にAUTOにならない、原因はミッション実行後ミッションデータを破棄して
クリアするが、データをアップロードしていない場合もミッション実行ループが実行
可能になっていたため、アップロード後で無いとMISSIONが実行されないように修正

・ミッションアップロード時、起動後１回目のアップロードWP数が設定値より少なくなる
現象の対策
→　アップロードデータ数とアップロードされたデータ数を比較して、一致しない場合、
一致するまでアップロードを繰り返す。
懸念点：永遠に一致しない場合は永久ループになるため対策が必要

・ミッション実行時のみしかAUTOモードに変更できないように修正

=================================================================================
